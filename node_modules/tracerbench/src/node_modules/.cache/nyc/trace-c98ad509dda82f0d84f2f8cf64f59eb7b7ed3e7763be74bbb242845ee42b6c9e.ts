"use strict";function cov_1wmjbuuxyq(){var path="/Users/malynch/D/tracerbench/packages/cli/src/commands/trace.ts";var hash="fca4ac2751a8e9f531e6bf4a4505be64c6ea16ab";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/malynch/D/tracerbench/packages/cli/src/commands/trace.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:4,column:15},end:{line:4,column:43}},"2":{start:{line:5,column:19},end:{line:5,column:38}},"3":{start:{line:6,column:13},end:{line:6,column:28}},"4":{start:{line:7,column:25},end:{line:7,column:53}},"5":{start:{line:8,column:16},end:{line:8,column:43}},"6":{start:{line:9,column:16},end:{line:9,column:43}},"7":{start:{line:12,column:26},end:{line:12,column:43}},"8":{start:{line:13,column:111},end:{line:13,column:116}},"9":{start:{line:14,column:24},end:{line:14,column:28}},"10":{start:{line:15,column:28},end:{line:15,column:80}},"11":{start:{line:16,column:25},end:{line:16,column:46}},"12":{start:{line:17,column:29},end:{line:17,column:64}},"13":{start:{line:18,column:27},end:{line:21,column:9}},"14":{start:{line:24,column:8},end:{line:31,column:9}},"15":{start:{line:25,column:12},end:{line:27,column:13}},"16":{start:{line:26,column:16},end:{line:26,column:54}},"17":{start:{line:30,column:12},end:{line:30,column:30}},"18":{start:{line:33,column:8},end:{line:33,column:114}},"19":{start:{line:35,column:32},end:{line:35,column:101}},"20":{start:{line:36,column:31},end:{line:40,column:9}},"21":{start:{line:42,column:8},end:{line:42,column:45}},"22":{start:{line:43,column:8},end:{line:106,column:9}},"23":{start:{line:46,column:34},end:{line:46,column:35}},"24":{start:{line:47,column:35},end:{line:47,column:36}},"25":{start:{line:48,column:28},end:{line:48,column:37}},"26":{start:{line:49,column:12},end:{line:54,column:13}},"27":{start:{line:50,column:16},end:{line:50,column:60}},"28":{start:{line:53,column:16},end:{line:53,column:39}},"29":{start:{line:55,column:12},end:{line:63,column:15}},"30":{start:{line:56,column:35},end:{line:56,column:66}},"31":{start:{line:57,column:35},end:{line:57,column:54}},"32":{start:{line:59,column:28},end:{line:59,column:47}},"33":{start:{line:60,column:37},end:{line:60,column:53}},"34":{start:{line:61,column:16},end:{line:61,column:48}},"35":{start:{line:62,column:16},end:{line:62,column:67}},"36":{start:{line:65,column:12},end:{line:65,column:92}},"37":{start:{line:67,column:12},end:{line:75,column:15}},"38":{start:{line:68,column:35},end:{line:68,column:73}},"39":{start:{line:69,column:35},end:{line:69,column:64}},"40":{start:{line:71,column:28},end:{line:71,column:57}},"41":{start:{line:72,column:37},end:{line:72,column:53}},"42":{start:{line:73,column:16},end:{line:73,column:49}},"43":{start:{line:74,column:16},end:{line:74,column:68}},"44":{start:{line:77,column:12},end:{line:77,column:94}},"45":{start:{line:79,column:12},end:{line:95,column:13}},"46":{start:{line:80,column:32},end:{line:80,column:74}},"47":{start:{line:81,column:16},end:{line:91,column:17}},"48":{start:{line:82,column:20},end:{line:85,column:23}},"49":{start:{line:83,column:81},end:{line:83,column:95}},"50":{start:{line:84,column:24},end:{line:84,column:117}},"51":{start:{line:88,column:20},end:{line:90,column:23}},"52":{start:{line:89,column:24},end:{line:89,column:90}},"53":{start:{line:94,column:16},end:{line:94,column:34}},"54":{start:{line:96,column:12},end:{line:105,column:13}},"55":{start:{line:97,column:16},end:{line:97,column:60}},"56":{start:{line:98,column:34},end:{line:98,column:68}},"57":{start:{line:99,column:16},end:{line:101,column:19}},"58":{start:{line:100,column:20},end:{line:100,column:71}},"59":{start:{line:104,column:16},end:{line:104,column:39}},"60":{start:{line:109,column:0},end:{line:109,column:24}},"61":{start:{line:110,column:0},end:{line:110,column:125}},"62":{start:{line:111,column:0},end:{line:121,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:11,column:4},end:{line:11,column:5}},loc:{start:{line:11,column:16},end:{line:107,column:5}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:56,column:24},end:{line:56,column:25}},loc:{start:{line:56,column:35},end:{line:56,column:66}},line:56},"2":{name:"(anonymous_2)",decl:{start:{line:57,column:24},end:{line:57,column:25}},loc:{start:{line:57,column:35},end:{line:57,column:54}},line:57},"3":{name:"(anonymous_3)",decl:{start:{line:58,column:25},end:{line:58,column:26}},loc:{start:{line:58,column:36},end:{line:63,column:13}},line:58},"4":{name:"(anonymous_4)",decl:{start:{line:68,column:24},end:{line:68,column:25}},loc:{start:{line:68,column:35},end:{line:68,column:73}},line:68},"5":{name:"(anonymous_5)",decl:{start:{line:69,column:24},end:{line:69,column:25}},loc:{start:{line:69,column:35},end:{line:69,column:64}},line:69},"6":{name:"(anonymous_6)",decl:{start:{line:70,column:25},end:{line:70,column:26}},loc:{start:{line:70,column:36},end:{line:75,column:13}},line:70},"7":{name:"(anonymous_7)",decl:{start:{line:82,column:44},end:{line:82,column:45}},loc:{start:{line:82,column:54},end:{line:85,column:21}},line:82},"8":{name:"(anonymous_8)",decl:{start:{line:88,column:44},end:{line:88,column:45}},loc:{start:{line:88,column:54},end:{line:90,column:21}},line:88},"9":{name:"(anonymous_9)",decl:{start:{line:99,column:34},end:{line:99,column:35}},loc:{start:{line:99,column:76},end:{line:101,column:17}},line:99}},branchMap:{"0":{loc:{start:{line:25,column:12},end:{line:27,column:13}},type:"if",locations:[{start:{line:25,column:12},end:{line:27,column:13}},{start:{line:25,column:12},end:{line:27,column:13}}],line:25},"1":{loc:{start:{line:43,column:8},end:{line:106,column:9}},type:"if",locations:[{start:{line:43,column:8},end:{line:106,column:9}},{start:{line:43,column:8},end:{line:106,column:9}}],line:43},"2":{loc:{start:{line:81,column:16},end:{line:91,column:17}},type:"if",locations:[{start:{line:81,column:16},end:{line:91,column:17}},{start:{line:81,column:16},end:{line:91,column:17}}],line:81}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},inputSourceMap:{version:3,file:"/Users/malynch/D/tracerbench/packages/cli/src/commands/trace.ts",sources:["/Users/malynch/D/tracerbench/packages/cli/src/commands/trace.ts"],names:[],mappings:"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",sourcesContent:["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport {\n  analyze,\n  IAnalyze,\n  IConditions,\n  ITraceEvent,\n  liveTrace,\n  loadTrace,\n} from \"@tracerbench/core\";\nimport { existsSync, mkdirSync, readJson, writeFileSync } from \"fs-extra\";\nimport * as path from \"path\";\n\nimport { TBBaseCommand } from \"../command-config\";\nimport {\n  cookiespath,\n  cpuThrottleRate,\n  harpath,\n  insights,\n  iterations,\n  locations,\n  network,\n  tbResultsFolder,\n  url,\n} from \"../helpers/flags\";\nimport {\n  isCommitLoad,\n  normalizeFnName,\n  setTraceEvents,\n} from \"../helpers/utils\";\n\nexport default class Trace extends TBBaseCommand {\n  public static description = `Parses a CPU profile and aggregates time across heuristics. Can be vertically sliced with event names.`;\n  public static flags = {\n    cpuThrottleRate: cpuThrottleRate({ required: true }),\n    tbResultsFolder: tbResultsFolder({ required: true }),\n    harpath: harpath({ required: true }),\n    network: network(),\n    url: url({ required: true }),\n    cookiespath: cookiespath({ required: true }),\n    iterations: iterations({ required: true }),\n    locations: locations(),\n    insights,\n  };\n\n  public async run() {\n    const { flags } = this.parse(Trace);\n    const {\n      url,\n      cpuThrottleRate,\n      cookiespath,\n      tbResultsFolder,\n      insights,\n      locations,\n      network,\n      harpath,\n    } = flags;\n\n    const methods = [\"\"];\n    const cookiesJSON = await readJson(path.resolve(cookiespath));\n    const traceHAR = path.resolve(harpath);\n    const traceHARJSON = await readJson(traceHAR);\n    const conditions: IConditions = {\n      cpu: cpuThrottleRate,\n      network,\n    };\n    // if the folder for the tracerbench results file\n    // does not exist then create it\n    try {\n      if (!existsSync(tbResultsFolder)) {\n        mkdirSync(tbResultsFolder);\n      }\n    } catch (error) {\n      this.error(error);\n    }\n    // write the trace.json\n    writeFileSync(\n      path.join(tbResultsFolder, \"trace.json\"),\n      JSON.stringify(traceHARJSON, null, 2)\n    );\n\n    // run the liveTrace\n    const { traceEvents } = await liveTrace(\n      url,\n      tbResultsFolder,\n      cookiesJSON,\n      conditions\n    );\n\n    const analyzeOptions: IAnalyze = {\n      traceEvents,\n      traceHARJSON,\n      methods,\n    };\n\n    // analyze the liveTrace\n    await analyze(analyzeOptions);\n\n    if (insights) {\n      // js-eval-time\n      let trace: any;\n      let totalJSDuration = 0;\n      let totalCSSDuration = 0;\n\n      const methods = new Set();\n\n      try {\n        trace = setTraceEvents(traceEvents);\n      } catch (error) {\n        this.error(`${error}`);\n      }\n\n      trace\n        .filter((event: ITraceEvent) => event.name === \"EvaluateScript\")\n        .filter((event: any) => event.args.data.url)\n        .forEach((event: any) => {\n          const url = event.args.data.url;\n          const durationInMs = (event.dur as number) / 1000;\n          totalJSDuration += durationInMs;\n          this.log(`JS: ${url}: ${durationInMs.toFixed(2)}`);\n        });\n\n      // log js-eval-time\n      this.log(\n        `JS: Evaluation Total Duration: ${totalJSDuration.toFixed(2)}ms \\n\\n`\n      );\n\n      // css-parse\n      trace\n        .filter((event: ITraceEvent) => event.name === \"ParseAuthorStyleSheet\")\n        .filter((event: any) => event.args.data.styleSheetUrl)\n        .forEach((event: any) => {\n          const url = event.args.data.styleSheetUrl;\n          const durationInMs = event.dur / 1000;\n          totalCSSDuration += durationInMs;\n          this.log(`CSS: ${url}: ${durationInMs.toFixed(2)}`);\n        });\n\n      // log css-parse-time\n      this.log(\n        `CSS: Evaluation Total Duration: ${totalCSSDuration.toFixed(2)}ms \\n\\n`\n      );\n\n      // list-functions\n      try {\n        const profile = loadTrace(trace).cpuProfile(-1, -1);\n        if (locations) {\n          profile.nodeMap.forEach((node: any) => {\n            const {\n              functionName,\n              url,\n              lineNumber,\n              columnNumber,\n            } = node.callFrame;\n\n            methods.add(\n              `${url}:${lineNumber}:${columnNumber}.${normalizeFnName(\n                functionName\n              )}`\n            );\n          });\n        } else {\n          profile.nodeMap.forEach((node: any) => {\n            methods.add(normalizeFnName(node.callFrame.functionName));\n          });\n        }\n      } catch (error) {\n        this.error(error);\n      }\n\n      try {\n        trace = setTraceEvents(traceEvents);\n        const traceLoad = trace.filter(isCommitLoad);\n        traceLoad.forEach(\n          ({\n            args: {\n              data: { frame, url },\n            },\n          }: {\n            args: { data: { frame: any; url: any } };\n          }) => {\n            this.log(`Frame-URL: ${url} | Frame-ID: ${frame}`);\n          }\n        );\n      } catch (error) {\n        this.error(`${error}`);\n      }\n    }\n  }\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fca4ac2751a8e9f531e6bf4a4505be64c6ea16ab"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1wmjbuuxyq=function(){return actualCoverage;};return actualCoverage;}cov_1wmjbuuxyq().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});/* eslint-disable @typescript-eslint/explicit-function-return-type */const core_1=(cov_1wmjbuuxyq().s[1]++,require("@tracerbench/core"));const fs_extra_1=(cov_1wmjbuuxyq().s[2]++,require("fs-extra"));const path=(cov_1wmjbuuxyq().s[3]++,require("path"));const command_config_1=(cov_1wmjbuuxyq().s[4]++,require("../command-config"));const flags_1=(cov_1wmjbuuxyq().s[5]++,require("../helpers/flags"));const utils_1=(cov_1wmjbuuxyq().s[6]++,require("../helpers/utils"));class Trace extends(command_config_1.TBBaseCommand){async run(){cov_1wmjbuuxyq().f[0]++;const{flags}=(cov_1wmjbuuxyq().s[7]++,this.parse(Trace));const{url,cpuThrottleRate,cookiespath,tbResultsFolder,insights,locations,network,harpath}=(cov_1wmjbuuxyq().s[8]++,flags);const methods=(cov_1wmjbuuxyq().s[9]++,[""]);const cookiesJSON=(cov_1wmjbuuxyq().s[10]++,await fs_extra_1.readJson(path.resolve(cookiespath)));const traceHAR=(cov_1wmjbuuxyq().s[11]++,path.resolve(harpath));const traceHARJSON=(cov_1wmjbuuxyq().s[12]++,await fs_extra_1.readJson(traceHAR));const conditions=(cov_1wmjbuuxyq().s[13]++,{cpu:cpuThrottleRate,network});// if the folder for the tracerbench results file
// does not exist then create it
cov_1wmjbuuxyq().s[14]++;try{cov_1wmjbuuxyq().s[15]++;if(!fs_extra_1.existsSync(tbResultsFolder)){cov_1wmjbuuxyq().b[0][0]++;cov_1wmjbuuxyq().s[16]++;fs_extra_1.mkdirSync(tbResultsFolder);}else{cov_1wmjbuuxyq().b[0][1]++;}}catch(error){cov_1wmjbuuxyq().s[17]++;this.error(error);}// write the trace.json
cov_1wmjbuuxyq().s[18]++;fs_extra_1.writeFileSync(path.join(tbResultsFolder,"trace.json"),JSON.stringify(traceHARJSON,null,2));// run the liveTrace
const{traceEvents}=(cov_1wmjbuuxyq().s[19]++,await core_1.liveTrace(url,tbResultsFolder,cookiesJSON,conditions));const analyzeOptions=(cov_1wmjbuuxyq().s[20]++,{traceEvents,traceHARJSON,methods});// analyze the liveTrace
cov_1wmjbuuxyq().s[21]++;await core_1.analyze(analyzeOptions);cov_1wmjbuuxyq().s[22]++;if(insights){cov_1wmjbuuxyq().b[1][0]++;// js-eval-time
let trace;let totalJSDuration=(cov_1wmjbuuxyq().s[23]++,0);let totalCSSDuration=(cov_1wmjbuuxyq().s[24]++,0);const methods=(cov_1wmjbuuxyq().s[25]++,new Set());cov_1wmjbuuxyq().s[26]++;try{cov_1wmjbuuxyq().s[27]++;trace=utils_1.setTraceEvents(traceEvents);}catch(error){cov_1wmjbuuxyq().s[28]++;this.error(`${error}`);}cov_1wmjbuuxyq().s[29]++;trace.filter(event=>{cov_1wmjbuuxyq().f[1]++;cov_1wmjbuuxyq().s[30]++;return event.name==="EvaluateScript";}).filter(event=>{cov_1wmjbuuxyq().f[2]++;cov_1wmjbuuxyq().s[31]++;return event.args.data.url;}).forEach(event=>{cov_1wmjbuuxyq().f[3]++;const url=(cov_1wmjbuuxyq().s[32]++,event.args.data.url);const durationInMs=(cov_1wmjbuuxyq().s[33]++,event.dur/1000);cov_1wmjbuuxyq().s[34]++;totalJSDuration+=durationInMs;cov_1wmjbuuxyq().s[35]++;this.log(`JS: ${url}: ${durationInMs.toFixed(2)}`);});// log js-eval-time
cov_1wmjbuuxyq().s[36]++;this.log(`JS: Evaluation Total Duration: ${totalJSDuration.toFixed(2)}ms \n\n`);// css-parse
cov_1wmjbuuxyq().s[37]++;trace.filter(event=>{cov_1wmjbuuxyq().f[4]++;cov_1wmjbuuxyq().s[38]++;return event.name==="ParseAuthorStyleSheet";}).filter(event=>{cov_1wmjbuuxyq().f[5]++;cov_1wmjbuuxyq().s[39]++;return event.args.data.styleSheetUrl;}).forEach(event=>{cov_1wmjbuuxyq().f[6]++;const url=(cov_1wmjbuuxyq().s[40]++,event.args.data.styleSheetUrl);const durationInMs=(cov_1wmjbuuxyq().s[41]++,event.dur/1000);cov_1wmjbuuxyq().s[42]++;totalCSSDuration+=durationInMs;cov_1wmjbuuxyq().s[43]++;this.log(`CSS: ${url}: ${durationInMs.toFixed(2)}`);});// log css-parse-time
cov_1wmjbuuxyq().s[44]++;this.log(`CSS: Evaluation Total Duration: ${totalCSSDuration.toFixed(2)}ms \n\n`);// list-functions
cov_1wmjbuuxyq().s[45]++;try{const profile=(cov_1wmjbuuxyq().s[46]++,core_1.loadTrace(trace).cpuProfile(-1,-1));cov_1wmjbuuxyq().s[47]++;if(locations){cov_1wmjbuuxyq().b[2][0]++;cov_1wmjbuuxyq().s[48]++;profile.nodeMap.forEach(node=>{cov_1wmjbuuxyq().f[7]++;const{functionName,url,lineNumber,columnNumber}=(cov_1wmjbuuxyq().s[49]++,node.callFrame);cov_1wmjbuuxyq().s[50]++;methods.add(`${url}:${lineNumber}:${columnNumber}.${utils_1.normalizeFnName(functionName)}`);});}else{cov_1wmjbuuxyq().b[2][1]++;cov_1wmjbuuxyq().s[51]++;profile.nodeMap.forEach(node=>{cov_1wmjbuuxyq().f[8]++;cov_1wmjbuuxyq().s[52]++;methods.add(utils_1.normalizeFnName(node.callFrame.functionName));});}}catch(error){cov_1wmjbuuxyq().s[53]++;this.error(error);}cov_1wmjbuuxyq().s[54]++;try{cov_1wmjbuuxyq().s[55]++;trace=utils_1.setTraceEvents(traceEvents);const traceLoad=(cov_1wmjbuuxyq().s[56]++,trace.filter(utils_1.isCommitLoad));cov_1wmjbuuxyq().s[57]++;traceLoad.forEach(({args:{data:{frame,url}}})=>{cov_1wmjbuuxyq().f[9]++;cov_1wmjbuuxyq().s[58]++;this.log(`Frame-URL: ${url} | Frame-ID: ${frame}`);});}catch(error){cov_1wmjbuuxyq().s[59]++;this.error(`${error}`);}}else{cov_1wmjbuuxyq().b[1][1]++;}}}cov_1wmjbuuxyq().s[60]++;exports.default=Trace;cov_1wmjbuuxyq().s[61]++;Trace.description=`Parses a CPU profile and aggregates time across heuristics. Can be vertically sliced with event names.`;cov_1wmjbuuxyq().s[62]++;Trace.flags={cpuThrottleRate:flags_1.cpuThrottleRate({required:true}),tbResultsFolder:flags_1.tbResultsFolder({required:true}),harpath:flags_1.harpath({required:true}),network:flags_1.network(),url:flags_1.url({required:true}),cookiespath:flags_1.cookiespath({required:true}),iterations:flags_1.iterations({required:true}),locations:flags_1.locations(),insights:flags_1.insights};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL21hbHluY2gvRC90cmFjZXJiZW5jaC9wYWNrYWdlcy9jbGkvc3JjL2NvbW1hbmRzL3RyYWNlLnRzIiwic291cmNlcyI6WyIvVXNlcnMvbWFseW5jaC9EL3RyYWNlcmJlbmNoL3BhY2thZ2VzL2NsaS9zcmMvY29tbWFuZHMvdHJhY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxxRUFBcUU7QUFDckUsNENBTzJCO0FBQzNCLHVDQUEwRTtBQUMxRSw2QkFBNkI7QUFFN0Isc0RBQWtEO0FBQ2xELDRDQVUwQjtBQUMxQiw0Q0FJMEI7QUFFMUIsTUFBcUIsS0FBTSxTQUFRLDhCQUFhO0lBY3ZDLEtBQUssQ0FBQyxHQUFHO1FBQ2QsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsTUFBTSxFQUNKLEdBQUcsRUFDSCxlQUFlLEVBQ2YsV0FBVyxFQUNYLGVBQWUsRUFDZixRQUFRLEVBQ1IsU0FBUyxFQUNULE9BQU8sRUFDUCxPQUFPLEdBQ1IsR0FBRyxLQUFLLENBQUM7UUFFVixNQUFNLE9BQU8sR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sV0FBVyxHQUFHLE1BQU0sbUJBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDOUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN2QyxNQUFNLFlBQVksR0FBRyxNQUFNLG1CQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUMsTUFBTSxVQUFVLEdBQWdCO1lBQzlCLEdBQUcsRUFBRSxlQUFlO1lBQ3BCLE9BQU87U0FDUixDQUFDO1FBQ0YsaURBQWlEO1FBQ2pELGdDQUFnQztRQUNoQyxJQUFJO1lBQ0YsSUFBSSxDQUFDLHFCQUFVLENBQUMsZUFBZSxDQUFDLEVBQUU7Z0JBQ2hDLG9CQUFTLENBQUMsZUFBZSxDQUFDLENB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LENBQUMsY0FBYyxHQUFHLGdCQUFnQixLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUNyRCxDQUFDLENBQ0YsQ0FBQzthQUNIO1lBQUMsT0FBTyxLQUFLLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDeEI7U0FDRjtJQUNILENBQUM7O0FBN0pILHdCQThKQztBQTdKZSxpQkFBVyxHQUFHLHdHQUF3RyxDQUFDO0FBQ3ZILFdBQUssR0FBRztJQUNwQixlQUFlLEVBQUUsdUJBQWUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUNwRCxlQUFlLEVBQUUsdUJBQWUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUNwRCxPQUFPLEVBQUUsZUFBTyxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQ3BDLE9BQU8sRUFBRSxlQUFPLEVBQUU7SUFDbEIsR0FBRyxFQUFFLFdBQUcsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUM1QixXQUFXLEVBQUUsbUJBQVcsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUM1QyxVQUFVLEVBQUUsa0JBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUMxQyxTQUFTLEVBQUUsaUJBQVMsRUFBRTtJQUN0QixRQUFRLEVBQVIsZ0JBQVE7Q0FDVCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L2V4cGxpY2l0LWZ1bmN0aW9uLXJldHVybi10eXBlICovXG5pbXBvcnQge1xuICBhbmFseXplLFxuICBJQW5hbHl6ZSxcbiAgSUNvbmRpdGlvbnMsXG4gIElUcmFjZUV2ZW50LFxuICBsaXZlVHJhY2UsXG4gIGxvYWRUcmFjZSxcbn0gZnJvbSBcIkB0cmFjZXJiZW5jaC9jb3JlXCI7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCBta2RpclN5bmMsIHJlYWRKc29uLCB3cml0ZUZpbGVTeW5jIH0gZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XG5cbmltcG9ydCB7IFRCQmFzZUNvbW1hbmQgfSBmcm9tIFwiLi4vY29tbWFuZC1jb25maWdcIjtcbmltcG9ydCB7XG4gIGNvb2tpZXNwYXRoLFxuICBjcHVUaHJvdHRsZVJhdGUsXG4gIGhhcnBhdGgsXG4gIGluc2lnaHRzLFxuICBpdGVyYXRpb25zLFxuICBsb2NhdGlvbnMsXG4gIG5ldHdvcmssXG4gIHRiUmVzdWx0c0ZvbGRlcixcbiAgdXJsLFxufSBmcm9tIFwiLi4vaGVscGVycy9mbGFnc1wiO1xuaW1wb3J0IHtcbiAgaXNDb21taXRMb2FkLFxuICBub3JtYWxpemVGbk5hbWUsXG4gIHNldFRyYWNlRXZlbnRzLFxufSBmcm9tIFwiLi4vaGVscGVycy91dGlsc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUcmFjZSBleHRlbmRzIFRCQmFzZUNvbW1hbmQge1xuICBwdWJsaWMgc3RhdGljIGRlc2NyaXB0aW9uID0gYFBhcnNlcyBhIENQVSBwcm9maWxlIGFuZCBhZ2dyZWdhdGVzIHRpbWUgYWNyb3NzIGhldXJpc3RpY3MuIENhbiBiZSB2ZXJ0aWNhbGx5IHNsaWNlZCB3aXRoIGV2ZW50IG5hbWVzLmA7XG4gIHB1YmxpYyBzdGF0aWMgZmxhZ3MgPSB7XG4gICAgY3B1VGhyb3R0bGVSYXRlOiBjcHVUaHJvdHRsZVJhdGUoeyByZXF1aXJlZDogdHJ1ZSB9KSxcbiAgICB0YlJlc3VsdHNGb2xkZXI6IHRiUmVzdWx0c0ZvbGRlcih7IHJlcXVpcmVkOiB0cnVlIH0pLFxuICAgIGhhcnBhdGg6IGhhcnBhdGgoeyByZXF1aXJlZDogdHJ1ZSB9KSxcbiAgICBuZXR3b3JrOiBuZXR3b3JrKCksXG4gICAgdXJsOiB1cmwoeyByZXF1aXJlZDogdHJ1ZSB9KSxcbiAgICBjb29raWVzcGF0aDogY29va2llc3BhdGgoeyByZXF1aXJlZDogdHJ1ZSB9KSxcbiAgICBpdGVyYXRpb25zOiBpdGVyYXRpb25zKHsgcmVxdWlyZWQ6IHRydWUgfSksXG4gICAgbG9jYXRpb25zOiBsb2NhdGlvbnMoKSxcbiAgICBpbnNpZ2h0cyxcbiAgfTtcblxuICBwdWJsaWMgYXN5bmMgcnVuKCkge1xuICAgIGNvbnN0IHsgZmxhZ3MgfSA9IHRoaXMucGFyc2UoVHJhY2UpO1xuICAgIGNvbnN0IHtcbiAgICAgIHVybCxcbiAgICAgIGNwdVRocm90dGxlUmF0ZSxcbiAgICAgIGNvb2tpZXNwYXRoLFxuICAgICAgdGJSZXN1bHRzRm9sZGVyLFxuICAgICAgaW5zaWdodHMsXG4gICAgICBsb2NhdGlvbnMsXG4gICAgICBuZXR3b3JrLFxuICAgICAgaGFycGF0aCxcbiAgICB9ID0gZmxhZ3M7XG5cbiAgICBjb25zdCBtZXRob2RzID0gW1wiXCJdO1xuICAgIGNvbnN0IGNvb2tpZXNKU09OID0gYXdhaXQgcmVhZEpzb24ocGF0aC5yZXNvbHZlKGNvb2tpZXNwYXRoKSk7XG4gICAgY29uc3QgdHJhY2VIQVIgPSBwYXRoLnJlc29sdmUoaGFycGF0aCk7XG4gICAgY29uc3QgdHJhY2VIQVJKU09OID0gYXdhaXQgcmVhZEpzb24odHJhY2VIQVIpO1xuICAgIGNvbnN0IGNvbmRpdGlvbnM6IElDb25kaXRpb25zID0ge1xuICAgICAgY3B1OiBjcHVUaHJvdHRsZVJhdGUsXG4gICAgICBuZXR3b3JrLFxuICAgIH07XG4gICAgLy8gaWYgdGhlIGZvbGRlciBmb3IgdGhlIHRyYWNlcmJlbmNoIHJlc3VsdHMgZmlsZVxuICAgIC8vIGRvZXMgbm90IGV4aXN0IHRoZW4gY3JlYXRlIGl0XG4gICAgdHJ5IHtcbiAgICAgIGlmICghZXhpc3RzU3luYyh0YlJlc3VsdHNGb2xkZXIpKSB7XG4gICAgICAgIG1rZGlyU3luYyh0YlJlc3VsdHNGb2xkZXIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmVycm9yKGVycm9yKTtcbiAgICB9XG4gICAgLy8gd3JpdGUgdGhlIHRyYWNlLmpzb25cbiAgICB3cml0ZUZpbGVTeW5jKFxuICAgICAgcGF0aC5qb2luKHRiUmVzdWx0c0ZvbGRlciwgXCJ0cmFjZS5qc29uXCIpLFxuICAgICAgSlNPTi5zdHJpbmdpZnkodHJhY2VIQVJKU09OLCBudWxsLCAyKVxuICAgICk7XG5cbiAgICAvLyBydW4gdGhlIGxpdmVUcmFjZVxuICAgIGNvbnN0IHsgdHJhY2VFdmVudHMgfSA9IGF3YWl0IGxpdmVUcmFjZShcbiAgICAgIHVybCxcbiAgICAgIHRiUmVzdWx0c0ZvbGRlcixcbiAgICAgIGNvb2tpZXNKU09OLFxuICAgICAgY29uZGl0aW9uc1xuICAgICk7XG5cbiAgICBjb25zdCBhbmFseXplT3B0aW9uczogSUFuYWx5emUgPSB7XG4gICAgICB0cmFjZUV2ZW50cyxcbiAgICAgIHRyYWNlSEFSSlNPTixcbiAgICAgIG1ldGhvZHMsXG4gICAgfTtcblxuICAgIC8vIGFuYWx5emUgdGhlIGxpdmVUcmFjZVxuICAgIGF3YWl0IGFuYWx5emUoYW5hbHl6ZU9wdGlvbnMpO1xuXG4gICAgaWYgKGluc2lnaHRzKSB7XG4gICAgICAvLyBqcy1ldmFsLXRpbWVcbiAgICAgIGxldCB0cmFjZTogYW55O1xuICAgICAgbGV0IHRvdGFsSlNEdXJhdGlvbiA9IDA7XG4gICAgICBsZXQgdG90YWxDU1NEdXJhdGlvbiA9IDA7XG5cbiAgICAgIGNvbnN0IG1ldGhvZHMgPSBuZXcgU2V0KCk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHRyYWNlID0gc2V0VHJhY2VFdmVudHModHJhY2VFdmVudHMpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lcnJvcihgJHtlcnJvcn1gKTtcbiAgICAgIH1cblxuICAgICAgdHJhY2VcbiAgICAgICAgLmZpbHRlcigoZXZlbnQ6IElUcmFjZUV2ZW50KSA9PiBldmVudC5uYW1lID09PSBcIkV2YWx1YXRlU2NyaXB0XCIpXG4gICAgICAgIC5maWx0ZXIoKGV2ZW50OiBhbnkpID0+IGV2ZW50LmFyZ3MuZGF0YS51cmwpXG4gICAgICAgIC5mb3JFYWNoKChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgdXJsID0gZXZlbnQuYXJncy5kYXRhLnVybDtcbiAgICAgICAgICBjb25zdCBkdXJhdGlvbkluTXMgPSAoZXZlbnQuZHVyIGFzIG51bWJlcikgLyAxMDAwO1xuICAgICAgICAgIHRvdGFsSlNEdXJhdGlvbiArPSBkdXJhdGlvbkluTXM7XG4gICAgICAgICAgdGhpcy5sb2coYEpTOiAke3VybH06ICR7ZHVyYXRpb25Jbk1zLnRvRml4ZWQoMil9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAvLyBsb2cganMtZXZhbC10aW1lXG4gICAgICB0aGlzLmxvZyhcbiAgICAgICAgYEpTOiBFdmFsdWF0aW9uIFRvdGFsIER1cmF0aW9uOiAke3RvdGFsSlNEdXJhdGlvbi50b0ZpeGVkKDIpfW1zIFxcblxcbmBcbiAgICAgICk7XG5cbiAgICAgIC8vIGNzcy1wYXJzZVxuICAgICAgdHJhY2VcbiAgICAgICAgLmZpbHRlcigoZXZlbnQ6IElUcmFjZUV2ZW50KSA9PiBldmVudC5uYW1lID09PSBcIlBhcnNlQXV0aG9yU3R5bGVTaGVldFwiKVxuICAgICAgICAuZmlsdGVyKChldmVudDogYW55KSA9PiBldmVudC5hcmdzLmRhdGEuc3R5bGVTaGVldFVybClcbiAgICAgICAgLmZvckVhY2goKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCB1cmwgPSBldmVudC5hcmdzLmRhdGEuc3R5bGVTaGVldFVybDtcbiAgICAgICAgICBjb25zdCBkdXJhdGlvbkluTXMgPSBldmVudC5kdXIgLyAxMDAwO1xuICAgICAgICAgIHRvdGFsQ1NTRHVyYXRpb24gKz0gZHVyYXRpb25Jbk1zO1xuICAgICAgICAgIHRoaXMubG9nKGBDU1M6ICR7dXJsfTogJHtkdXJhdGlvbkluTXMudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vIGxvZyBjc3MtcGFyc2UtdGltZVxuICAgICAgdGhpcy5sb2coXG4gICAgICAgIGBDU1M6IEV2YWx1YXRpb24gVG90YWwgRHVyYXRpb246ICR7dG90YWxDU1NEdXJhdGlvbi50b0ZpeGVkKDIpfW1zIFxcblxcbmBcbiAgICAgICk7XG5cbiAgICAgIC8vIGxpc3QtZnVuY3Rpb25zXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9maWxlID0gbG9hZFRyYWNlKHRyYWNlKS5jcHVQcm9maWxlKC0xLCAtMSk7XG4gICAgICAgIGlmIChsb2NhdGlvbnMpIHtcbiAgICAgICAgICBwcm9maWxlLm5vZGVNYXAuZm9yRWFjaCgobm9kZTogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgICBsaW5lTnVtYmVyLFxuICAgICAgICAgICAgICBjb2x1bW5OdW1iZXIsXG4gICAgICAgICAgICB9ID0gbm9kZS5jYWxsRnJhbWU7XG5cbiAgICAgICAgICAgIG1ldGhvZHMuYWRkKFxuICAgICAgICAgICAgICBgJHt1cmx9OiR7bGluZU51bWJlcn06JHtjb2x1bW5OdW1iZXJ9LiR7bm9ybWFsaXplRm5OYW1lKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZVxuICAgICAgICAgICAgICApfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcHJvZmlsZS5ub2RlTWFwLmZvckVhY2goKG5vZGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgbWV0aG9kcy5hZGQobm9ybWFsaXplRm5OYW1lKG5vZGUuY2FsbEZyYW1lLmZ1bmN0aW9uTmFtZSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmVycm9yKGVycm9yKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgdHJhY2UgPSBzZXRUcmFjZUV2ZW50cyh0cmFjZUV2ZW50cyk7XG4gICAgICAgIGNvbnN0IHRyYWNlTG9hZCA9IHRyYWNlLmZpbHRlcihpc0NvbW1pdExvYWQpO1xuICAgICAgICB0cmFjZUxvYWQuZm9yRWFjaChcbiAgICAgICAgICAoe1xuICAgICAgICAgICAgYXJnczoge1xuICAgICAgICAgICAgICBkYXRhOiB7IGZyYW1lLCB1cmwgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfToge1xuICAgICAgICAgICAgYXJnczogeyBkYXRhOiB7IGZyYW1lOiBhbnk7IHVybDogYW55IH0gfTtcbiAgICAgICAgICB9KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZyhgRnJhbWUtVVJMOiAke3VybH0gfCBGcmFtZS1JRDogJHtmcmFtZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmVycm9yKGAke2Vycm9yfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWx5bmNoL0QvdHJhY2VyYmVuY2gvcGFja2FnZXMvY2xpL3NyYy9jb21tYW5kcy90cmFjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiKytmQUFBLHFFQUNBLEtBQUEsQ0FBQSxNQUFBLDBCQUFBLE9BQUEsQ0FBQSxtQkFBQSxDQUFBLENBQUEsQ0FRQSxLQUFBLENBQUEsVUFBQSwwQkFBQSxPQUFBLENBQUEsVUFBQSxDQUFBLENBQUEsQ0FDQSxLQUFBLENBQUEsSUFBQSwwQkFBQSxPQUFBLENBQUEsTUFBQSxDQUFBLENBQUEsQ0FFQSxLQUFBLENBQUEsZ0JBQUEsMEJBQUEsT0FBQSxDQUFBLG1CQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxPQUFBLDBCQUFBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBLENBQUEsQ0FXQSxLQUFBLENBQUEsT0FBQSwwQkFBQSxPQUFBLENBQUEsa0JBQUEsQ0FBQSxDQUFBLENBTUEsS0FBcUIsQ0FBQSxLQUFyQixTQUFtQyxnQkFBQSxDQUFBLGFBQW5DLENBQWdELENBY3ZDLEtBQU0sQ0FBQSxHQUFOLEVBQVMseUJBQ2QsS0FBTSxDQUFFLEtBQUYsMkJBQVksS0FBSyxLQUFMLENBQVcsS0FBWCxDQUFaLENBQU4sQ0FDQSxLQUFNLENBQ0osR0FESSxDQUVKLGVBRkksQ0FHSixXQUhJLENBSUosZUFKSSxDQUtKLFFBTEksQ0FNSixTQU5JLENBT0osT0FQSSxDQVFKLE9BUkksMkJBU0YsS0FURSxDQUFOLENBV0EsS0FBTSxDQUFBLE9BQU8sMEJBQUcsQ0FBQyxFQUFELENBQUgsQ0FBYixDQUNBLEtBQU0sQ0FBQSxXQUFXLDJCQUFHLEtBQU0sQ0FBQSxVQUFBLENBQUEsUUFBQSxDQUFTLElBQUksQ0FBQyxPQUFMLENBQWEsV0FBYixDQUFULENBQVQsQ0FBakIsQ0FDQSxLQUFNLENBQUEsUUFBUSwyQkFBRyxJQUFJLENBQUMsT0FBTCxDQUFhLE9BQWIsQ0FBSCxDQUFkLENBQ0EsS0FBTSxDQUFBLFlBQVksMkJB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QVgsQ0FQUSxDQVFwQixTQUFTLENBQUUsT0FBQSxDQUFBLFNBQUEsRUFSUyxDQVNwQixRQUFRLENBQVIsT0FBQSxDQUFBLFFBVG9CLENBQVIsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9leHBsaWNpdC1mdW5jdGlvbi1yZXR1cm4tdHlwZSAqL1xuaW1wb3J0IHtcbiAgYW5hbHl6ZSxcbiAgSUFuYWx5emUsXG4gIElDb25kaXRpb25zLFxuICBJVHJhY2VFdmVudCxcbiAgbGl2ZVRyYWNlLFxuICBsb2FkVHJhY2UsXG59IGZyb20gXCJAdHJhY2VyYmVuY2gvY29yZVwiO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgbWtkaXJTeW5jLCByZWFkSnNvbiwgd3JpdGVGaWxlU3luYyB9IGZyb20gXCJmcy1leHRyYVwiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuXG5pbXBvcnQgeyBUQkJhc2VDb21tYW5kIH0gZnJvbSBcIi4uL2NvbW1hbmQtY29uZmlnXCI7XG5pbXBvcnQge1xuICBjb29raWVzcGF0aCxcbiAgY3B1VGhyb3R0bGVSYXRlLFxuICBoYXJwYXRoLFxuICBpbnNpZ2h0cyxcbiAgaXRlcmF0aW9ucyxcbiAgbG9jYXRpb25zLFxuICBuZXR3b3JrLFxuICB0YlJlc3VsdHNGb2xkZXIsXG4gIHVybCxcbn0gZnJvbSBcIi4uL2hlbHBlcnMvZmxhZ3NcIjtcbmltcG9ydCB7XG4gIGlzQ29tbWl0TG9hZCxcbiAgbm9ybWFsaXplRm5OYW1lLFxuICBzZXRUcmFjZUV2ZW50cyxcbn0gZnJvbSBcIi4uL2hlbHBlcnMvdXRpbHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhY2UgZXh0ZW5kcyBUQkJhc2VDb21tYW5kIHtcbiAgcHVibGljIHN0YXRpYyBkZXNjcmlwdGlvbiA9IGBQYXJzZXMgYSBDUFUgcHJvZmlsZSBhbmQgYWdncmVnYXRlcyB0aW1lIGFjcm9zcyBoZXVyaXN0aWNzLiBDYW4gYmUgdmVydGljYWxseSBzbGljZWQgd2l0aCBldmVudCBuYW1lcy5gO1xuICBwdWJsaWMgc3RhdGljIGZsYWdzID0ge1xuICAgIGNwdVRocm90dGxlUmF0ZTogY3B1VGhyb3R0bGVSYXRlKHsgcmVxdWlyZWQ6IHRydWUgfSksXG4gICAgdGJSZXN1bHRzRm9sZGVyOiB0YlJlc3VsdHNGb2xkZXIoeyByZXF1aXJlZDogdHJ1ZSB9KSxcbiAgICBoYXJwYXRoOiBoYXJwYXRoKHsgcmVxdWlyZWQ6IHRydWUgfSksXG4gICAgbmV0d29yazogbmV0d29yaygpLFxuICAgIHVybDogdXJsKHsgcmVxdWlyZWQ6IHRydWUgfSksXG4gICAgY29va2llc3BhdGg6IGNvb2tpZXNwYXRoKHsgcmVxdWlyZWQ6IHRydWUgfSksXG4gICAgaXRlcmF0aW9uczogaXRlcmF0aW9ucyh7IHJlcXVpcmVkOiB0cnVlIH0pLFxuICAgIGxvY2F0aW9uczogbG9jYXRpb25zKCksXG4gICAgaW5zaWdodHMsXG4gIH07XG5cbiAgcHVibGljIGFzeW5jIHJ1bigpIHtcbiAgICBjb25zdCB7IGZsYWdzIH0gPSB0aGlzLnBhcnNlKFRyYWNlKTtcbiAgICBjb25zdCB7XG4gICAgICB1cmwsXG4gICAgICBjcHVUaHJvdHRsZVJhdGUsXG4gICAgICBjb29raWVzcGF0aCxcbiAgICAgIHRiUmVzdWx0c0ZvbGRlcixcbiAgICAgIGluc2lnaHRzLFxuICAgICAgbG9jYXRpb25zLFxuICAgICAgbmV0d29yayxcbiAgICAgIGhhcnBhdGgsXG4gICAgfSA9IGZsYWdzO1xuXG4gICAgY29uc3QgbWV0aG9kcyA9IFtcIlwiXTtcbiAgICBjb25zdCBjb29raWVzSlNPTiA9IGF3YWl0IHJlYWRKc29uKHBhdGgucmVzb2x2ZShjb29raWVzcGF0aCkpO1xuICAgIGNvbnN0IHRyYWNlSEFSID0gcGF0aC5yZXNvbHZlKGhhcnBhdGgpO1xuICAgIGNvbnN0IHRyYWNlSEFSSlNPTiA9IGF3YWl0IHJlYWRKc29uKHRyYWNlSEFSKTtcbiAgICBjb25zdCBjb25kaXRpb25zOiBJQ29uZGl0aW9ucyA9IHtcbiAgICAgIGNwdTogY3B1VGhyb3R0bGVSYXRlLFxuICAgICAgbmV0d29yayxcbiAgICB9O1xuICAgIC8vIGlmIHRoZSBmb2xkZXIgZm9yIHRoZSB0cmFjZXJiZW5jaCByZXN1bHRzIGZpbGVcbiAgICAvLyBkb2VzIG5vdCBleGlzdCB0aGVuIGNyZWF0ZSBpdFxuICAgIHRyeSB7XG4gICAgICBpZiAoIWV4aXN0c1N5bmModGJSZXN1bHRzRm9sZGVyKSkge1xuICAgICAgICBta2RpclN5bmModGJSZXN1bHRzRm9sZGVyKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5lcnJvcihlcnJvcik7XG4gICAgfVxuICAgIC8vIHdyaXRlIHRoZSB0cmFjZS5qc29uXG4gICAgd3JpdGVGaWxlU3luYyhcbiAgICAgIHBhdGguam9pbih0YlJlc3VsdHNGb2xkZXIsIFwidHJhY2UuanNvblwiKSxcbiAgICAgIEpTT04uc3RyaW5naWZ5KHRyYWNlSEFSSlNPTiwgbnVsbCwgMilcbiAgICApO1xuXG4gICAgLy8gcnVuIHRoZSBsaXZlVHJhY2VcbiAgICBjb25zdCB7IHRyYWNlRXZlbnRzIH0gPSBhd2FpdCBsaXZlVHJhY2UoXG4gICAgICB1cmwsXG4gICAgICB0YlJlc3VsdHNGb2xkZXIsXG4gICAgICBjb29raWVzSlNPTixcbiAgICAgIGNvbmRpdGlvbnNcbiAgICApO1xuXG4gICAgY29uc3QgYW5hbHl6ZU9wdGlvbnM6IElBbmFseXplID0ge1xuICAgICAgdHJhY2VFdmVudHMsXG4gICAgICB0cmFjZUhBUkpTT04sXG4gICAgICBtZXRob2RzLFxuICAgIH07XG5cbiAgICAvLyBhbmFseXplIHRoZSBsaXZlVHJhY2VcbiAgICBhd2FpdCBhbmFseXplKGFuYWx5emVPcHRpb25zKTtcblxuICAgIGlmIChpbnNpZ2h0cykge1xuICAgICAgLy8ganMtZXZhbC10aW1lXG4gICAgICBsZXQgdHJhY2U6IGFueTtcbiAgICAgIGxldCB0b3RhbEpTRHVyYXRpb24gPSAwO1xuICAgICAgbGV0IHRvdGFsQ1NTRHVyYXRpb24gPSAwO1xuXG4gICAgICBjb25zdCBtZXRob2RzID0gbmV3IFNldCgpO1xuXG4gICAgICB0cnkge1xuICAgICAgICB0cmFjZSA9IHNldFRyYWNlRXZlbnRzKHRyYWNlRXZlbnRzKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMuZXJyb3IoYCR7ZXJyb3J9YCk7XG4gICAgICB9XG5cbiAgICAgIHRyYWNlXG4gICAgICAgIC5maWx0ZXIoKGV2ZW50OiBJVHJhY2VFdmVudCkgPT4gZXZlbnQubmFtZSA9PT0gXCJFdmFsdWF0ZVNjcmlwdFwiKVxuICAgICAgICAuZmlsdGVyKChldmVudDogYW55KSA9PiBldmVudC5hcmdzLmRhdGEudXJsKVxuICAgICAgICAuZm9yRWFjaCgoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHVybCA9IGV2ZW50LmFyZ3MuZGF0YS51cmw7XG4gICAgICAgICAgY29uc3QgZHVyYXRpb25Jbk1zID0gKGV2ZW50LmR1ciBhcyBudW1iZXIpIC8gMTAwMDtcbiAgICAgICAgICB0b3RhbEpTRHVyYXRpb24gKz0gZHVyYXRpb25Jbk1zO1xuICAgICAgICAgIHRoaXMubG9nKGBKUzogJHt1cmx9OiAke2R1cmF0aW9uSW5Ncy50b0ZpeGVkKDIpfWApO1xuICAgICAgICB9KTtcblxuICAgICAgLy8gbG9nIGpzLWV2YWwtdGltZVxuICAgICAgdGhpcy5sb2coXG4gICAgICAgIGBKUzogRXZhbHVhdGlvbiBUb3RhbCBEdXJhdGlvbjogJHt0b3RhbEpTRHVyYXRpb24udG9GaXhlZCgyKX1tcyBcXG5cXG5gXG4gICAgICApO1xuXG4gICAgICAvLyBjc3MtcGFyc2VcbiAgICAgIHRyYWNlXG4gICAgICAgIC5maWx0ZXIoKGV2ZW50OiBJVHJhY2VFdmVudCkgPT4gZXZlbnQubmFtZSA9PT0gXCJQYXJzZUF1dGhvclN0eWxlU2hlZXRcIilcbiAgICAgICAgLmZpbHRlcigoZXZlbnQ6IGFueSkgPT4gZXZlbnQuYXJncy5kYXRhLnN0eWxlU2hlZXRVcmwpXG4gICAgICAgIC5mb3JFYWNoKChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgdXJsID0gZXZlbnQuYXJncy5kYXRhLnN0eWxlU2hlZXRVcmw7XG4gICAgICAgICAgY29uc3QgZHVyYXRpb25Jbk1zID0gZXZlbnQuZHVyIC8gMTAwMDtcbiAgICAgICAgICB0b3RhbENTU0R1cmF0aW9uICs9IGR1cmF0aW9uSW5NcztcbiAgICAgICAgICB0aGlzLmxvZyhgQ1NTOiAke3VybH06ICR7ZHVyYXRpb25Jbk1zLnRvRml4ZWQoMil9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAvLyBsb2cgY3NzLXBhcnNlLXRpbWVcbiAgICAgIHRoaXMubG9nKFxuICAgICAgICBgQ1NTOiBFdmFsdWF0aW9uIFRvdGFsIER1cmF0aW9uOiAke3RvdGFsQ1NTRHVyYXRpb24udG9GaXhlZCgyKX1tcyBcXG5cXG5gXG4gICAgICApO1xuXG4gICAgICAvLyBsaXN0LWZ1bmN0aW9uc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJvZmlsZSA9IGxvYWRUcmFjZSh0cmFjZSkuY3B1UHJvZmlsZSgtMSwgLTEpO1xuICAgICAgICBpZiAobG9jYXRpb25zKSB7XG4gICAgICAgICAgcHJvZmlsZS5ub2RlTWFwLmZvckVhY2goKG5vZGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICBmdW5jdGlvbk5hbWUsXG4gICAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgICAgbGluZU51bWJlcixcbiAgICAgICAgICAgICAgY29sdW1uTnVtYmVyLFxuICAgICAgICAgICAgfSA9IG5vZGUuY2FsbEZyYW1lO1xuXG4gICAgICAgICAgICBtZXRob2RzLmFkZChcbiAgICAgICAgICAgICAgYCR7dXJsfToke2xpbmVOdW1iZXJ9OiR7Y29sdW1uTnVtYmVyfS4ke25vcm1hbGl6ZUZuTmFtZShcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWVcbiAgICAgICAgICAgICAgKX1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByb2ZpbGUubm9kZU1hcC5mb3JFYWNoKChub2RlOiBhbnkpID0+IHtcbiAgICAgICAgICAgIG1ldGhvZHMuYWRkKG5vcm1hbGl6ZUZuTmFtZShub2RlLmNhbGxGcmFtZS5mdW5jdGlvbk5hbWUpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lcnJvcihlcnJvcik7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHRyYWNlID0gc2V0VHJhY2VFdmVudHModHJhY2VFdmVudHMpO1xuICAgICAgICBjb25zdCB0cmFjZUxvYWQgPSB0cmFjZS5maWx0ZXIoaXNDb21taXRMb2FkKTtcbiAgICAgICAgdHJhY2VMb2FkLmZvckVhY2goXG4gICAgICAgICAgKHtcbiAgICAgICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICAgICAgZGF0YTogeyBmcmFtZSwgdXJsIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH06IHtcbiAgICAgICAgICAgIGFyZ3M6IHsgZGF0YTogeyBmcmFtZTogYW55OyB1cmw6IGFueSB9IH07XG4gICAgICAgICAgfSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2coYEZyYW1lLVVSTDogJHt1cmx9IHwgRnJhbWUtSUQ6ICR7ZnJhbWV9YCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lcnJvcihgJHtlcnJvcn1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==