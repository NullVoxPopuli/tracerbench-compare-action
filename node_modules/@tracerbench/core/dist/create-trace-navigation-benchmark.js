"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const trace_model_1 = require("@tracerbench/trace-model");
const create_trace_benchmark_1 = require("./create-trace-benchmark");
const extract_navigation_sample_1 = require("./metrics/extract-navigation-sample");
const inject_mark_observer_1 = require("./util/inject-mark-observer");
const navigate_1 = require("./util/navigate");
const setup_page_1 = require("./util/setup-page");
function createTraceNavigationBenchmark(group, url, markers, options = {}) {
    if (markers.length === 0) {
        markers.push({
            start: 'navigationStart',
            label: 'load'
        }, {
            start: 'loadEventEnd',
            label: 'paint'
        });
    }
    return create_trace_benchmark_1.default(group, async (page, _i, _isTrial, raceCancel, trace) => {
        setup_page_1.default(page, raceCancel, options.pageSetupOptions);
        const { start: mark } = markers[markers.length - 1];
        const waitForMark = await inject_mark_observer_1.default(page, mark);
        return extract_navigation_sample_1.default(trace_model_1.buildModel(await trace(async (raceCancel) => {
            // do navigation
            await navigate_1.default(page, url, raceCancel);
            await waitForMark(raceCancel);
        })), markers);
    }, options);
}
exports.default = createTraceNavigationBenchmark;
//# sourceMappingURL=create-trace-navigation-benchmark.js.map